<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel do Professor - SENAI Presença</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styleDashboardProfessor.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <div class="dashboard-wrapper d-flex">
      <!-- SIDEBAR -->
      <div class="sidebar d-flex flex-column p-3">
        <div class="sidebar-header text-center mb-5">
          <span class="fw-bold me-1">SENAI</span><br>Presença Facial
        </div>
        <ul class="nav flex-column mb-auto">
          <li class="nav-item mb-2">
            <a
              href="{{ url_for('dashboard_professor') }}"
              class="nav-link active"
            >
              <i class="bi bi-house-door-fill me-2"></i> Dashboard
            </a>
          </li>

          <li class="nav-item mb-2">
            <a
              href="{{ url_for('professor_alunos') }}"
              class="nav-link"
            >
              <i class="bi bi-people-fill me-2"></i> Meus Alunos
            </a>
          </li>

          <li class="nav-item mb-2">
            <a
              href="{{ url_for('professor_relatorios') }}"
              class="nav-link"
            >
              <i class="bi bi-calendar-check-fill me-2"></i> Relatórios
            </a>
          </li>

          <li class="nav-item mb-2">
            <a href="{{ url_for('perfil_professor') }}" class="nav-link">
              <i class="bi bi-person-circle me-2"></i> Perfil
            </a>
          </li>
        </ul>

        <hr />
        <div class="dropdown">
          <a
            href="{{ url_for('logout_professor') }}"
            class="d-flex align-items-center text-decoration-none"
          >
            <i class="bi bi-box-arrow-right me-2 text-danger"></i>
            <strong class="text-danger">Sair</strong>
          </a>
        </div>
      </div>

      <!-- MAIN CONTENT -->
      <div class="main-content flex-grow-1">
        <header
          class="main-header p-3 mb-4 d-flex justify-content-between align-items-center"
        >
          <div class="welcome-info">
            <h5 class="mb-0">
              Olá, <span class="text-senai-red fw-bold">{{ nome }}!</span>
            </h5>
            <p class="text-muted-white small mb-0">
              {{ hoje.strftime("%A, %d de %B de %Y") }}
            </p>
          </div>
          <a
            href="{{ url_for('logout_professor') }}"
            class="btn btn-sm btn-outline-danger"
          >
            <i class="bi bi-box-arrow-right me-1"></i> Logout
          </a>
        </header>

        <div class="p-4 pt-0">
          <!-- CARDS DE RESUMO -->
          <div class="row mb-4">
            <div class="col-md-4">
              <div class="stat-card shadow-sm p-3">
                <i class="bi bi-calendar-check text-senai-red fs-4"></i>
                <p class="stat-value">{{ presencas_mes }}</p>
                <p class="stat-label">Presenças no Mês</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="stat-card shadow-sm p-3">
                <i class="bi bi-people-fill text-success fs-4"></i>
                <p class="stat-value">{{ total_alunos }}</p>
                <p class="stat-label">Alunos Cadastrados</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="stat-card shadow-sm p-3">
                <i class="bi bi-exclamation-triangle text-warning fs-4"></i>
                <p class="stat-value">{{ alunos_sem_presenca_hoje }}</p>
                <p class="stat-label">Alunos sem Presença Hoje</p>
              </div>
            </div>
          </div>

          <div class="row">
            <!-- GRÁFICO -->
            <div class="col-lg-8 mb-4">
              <div class="card main-area-card shadow-sm p-4" style="color: white">
                <h5 class="card-title mb-1">Presenças por turma</h5>
                <p class="text-muted-white small mb-3">
                  Últimos 7 dias (contagem de registros de presença)
                </p>
                <canvas id="presencaChart" height="140"></canvas>
              </div>
            </div>

            <!-- AÇÕES RÁPIDAS -->
            <div class="col-lg-4 mb-4">
              <div
                class="card main-area-card shadow-sm p-4"
                style="color: white"
              >
                <h5 class="card-title mb-3">Resumo Rápido</h5>
                <ul class="list-unstyled small text-muted-white mb-3">
                  <li>
                    Presenças registradas hoje:
                    <span class="text-senai-red fw-bold">{{ presencas_hoje }}</span>
                  </li>
                  <li>
                    Turmas ativas:
                    <span class="fw-bold">{{ total_turmas }}</span>
                  </li>
                </ul>

                <hr />

                <h5 class="card-title mb-3">Ações Rápidas</h5>
                <a
                  href="{{ url_for('cadastrar') }}"
                  class="btn btn-sm btn-outline-secondary w-100 mb-2"
                >
                  Cadastrar Novo Rosto
                </a>

                <a
                  href="{{ url_for('professor_relatorios') }}"
                  class="btn btn-sm btn-outline-secondary w-100"
                >
                  Ver Relatório de Hoje
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer-senai text-center p-2 small">
      © SENAI-SP {{ current_year }} | Sistema de Presença Facial
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js para o gráfico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js para o gráfico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Dados vindos do Flask, serializados como string JSON
      const chartLabels = JSON.parse('{{ chart_labels | default([], true) | tojson | safe }}');
      const chartData = JSON.parse('{{ chart_data | default({}, true) | tojson | safe }}');

      const datasets = Object.keys(chartData).map((turmaNome) => {
        return {
          label: turmaNome,
          data: chartData[turmaNome],
          borderWidth: 2,
          tension: 0.3
          // Chart.js define cores automaticamente se você não passar "borderColor"
        };
      });

      const ctx = document.getElementById('presencaChart');
      if (ctx && datasets.length > 0) {
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: chartLabels,
            datasets: datasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            },
            plugins: {
              legend: {
                labels: {
                  color: '#e5e7eb'
                }
              }
            }
          }
        });
      }
    </script>
  </body>
</html>
